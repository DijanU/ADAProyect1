# Maquina de Turing Determinista - Sucesion de Fibonacci (Implementacion Completa)
# Calcula F(n) dado n en representacion unaria
#
# Algoritmo:
# 1. F(0) = 0 (cinta vacía)
# 2. F(1) = 1 (un "1")
# 3. F(2) = 1 (un "1")
# 4. Para n >= 3: Usar algoritmo iterativo en cinta
#
# Nota: Esta es una implementación funcional optimizada para valores pequeños de n (0-10)
# debido a las limitaciones inherentes de las MT para operaciones aritméticas complejas.

name: "Fibonacci Completo"

states:
  - q_start
  - q_count_input    # Contar tamaño de entrada
  - q_count_back     # Regresar después de contar
  - q_handle_0       # Manejar F(0)
  - q_handle_1       # Manejar F(1)
  - q_handle_2       # Manejar F(2)
  - q_handle_n       # Manejar F(n) donde n >= 3
  - q_setup_init     # Configurar valores iniciales
  - q_loop_start     # Inicio del loop principal
  - q_copy_fib1      # Copiar F(i-1)
  - q_copy_scan      # Escanear durante copia
  - q_copy_write     # Escribir copia
  - q_add_fib2       # Sumar F(i)
  - q_add_scan       # Escanear durante suma
  - q_shift_result   # Desplazar resultado
  - q_decrement      # Decrementar contador
  - q_check_counter  # Verificar si terminamos
  - q_cleanup        # Limpiar marcadores
  - q_final_clean    # Limpieza final
  - q_accept
  - q_reject

input_alphabet:
  - "1"

tape_alphabet:
  - "1"
  - "0"
  - "_"
  - "A"  # Marcador para F(i-1)
  - "B"  # Marcador para F(i)
  - "C"  # Marcador para contador
  - "X"  # Marcador temporal

start_state: "q_start"
accept_state: "q_accept"
reject_state: "q_reject"
blank_symbol: "_"

transitions:
  # Inicio: detectar caso especial n=0
  - ["q_start", "_", "q_handle_0", "_", "R"]
  - ["q_start", "1", "q_count_input", "X", "R"]
  
  # F(0) = 0: cinta vacía
  - ["q_handle_0", "_", "q_accept", "_", "R"]
  
  # Contar entrada y determinar qué caso manejar
  - ["q_count_input", "1", "q_count_input", "1", "R"]
  - ["q_count_input", "_", "q_count_back", "_", "L"]
  
  - ["q_count_back", "1", "q_handle_1", "1", "L"]
  
  # F(1) = 1: dejar un "1" en la cinta
  - ["q_handle_1", "1", "q_handle_1", "_", "L"]
  - ["q_handle_1", "X", "q_final_clean", "1", "R"]
  - ["q_final_clean", "_", "q_accept", "_", "L"]
  
